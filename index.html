<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A tool to help you customize the background image of your presentation slides using A2K's presentation template.">
    <title>A2K Slide Tool</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

    <link rel="preload" href="main_frame.png" as="image">

</head>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.js" integrity="sha512-sn/GHTj+FCxK5wam7k9w4gPPm6zss4Zwl/X9wgrvGMFbnedR8lTUSLdsolDRBRzsX6N+YgG6OWyvn9qaFVXH9w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<body>
    <div id="viewport">
        <div id="preview_container" class="empty">
            <img src="" alt="" id="background_image">
        </div>
        <div id="frame">
            <input type="file" name="" id="file" accept=".png,.jpg,.jpeg,.webp">
            <div id="cropping_tools" class="collapsed">
                <div id="cropping_tools_container" class="wrapper not_ready">
                    <button
                        aria-label="toggle image cropping tools"
                        id="toggle_cropping_tools"
                        class="transparent_btn"
                    >
                        <svg id="chevron_icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><rect width="24" height="24" fill="none"/><path fill="currentColor" d="m12 10.8l-3.9 3.9q-.275.275-.7.275t-.7-.275t-.275-.7t.275-.7l4.6-4.6q.3-.3.7-.3t.7.3l4.6 4.6q.275.275.275.7t-.275.7t-.7.275t-.7-.275z"/></svg>
                        <svg id="crop_icon" xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24"><rect width="24" height="24" fill="none"/><path fill="currentColor" d="M12 24q-4.4 0-7.712-2.762T.174 14.275Q.1 13.85.337 13.5T1 13.1t.75.213t.4.687q.65 3.275 3.113 5.475T11.1 21.95l-.85-.85q-.275-.275-.275-.7t.275-.7t.7-.275t.7.275l3.3 3.3q.175.175.113.4t-.288.275q-.675.175-1.362.25T12 24m-3-7q-.825 0-1.412-.587T7 15V9H6q-.425 0-.712-.288T5 8t.288-.712T6 7h1V6q0-.425.288-.712T8 5t.713.288T9 6v9h9q.425 0 .713.288T19 16t-.288.713T18 17h-1v1q0 .425-.288.713T16 19t-.712-.288T15 18v-1zm6-4V9h-4V7h4q.825 0 1.413.588T17 9v4zM12 0q4.4 0 7.713 2.75t4.112 6.975q.075.425-.162.775t-.663.4t-.75-.213t-.4-.687q-.65-3.275-3.113-5.475T12.9 2.05l.85.85q.275.275.275.7t-.275.7t-.7.275t-.7-.275L9.05 1Q8.875.825 8.938.6t.287-.275Q9.9.15 10.588.075T12 0"/></svg>
                    </button>

                    <button
                        aria-label="rotate the image 90 degrees"
                        id="rotate"
                        class="transparent_btn"
                    >
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><rect width="24" height="24" fill="none"/><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M20 8a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H10a2 2 0 0 1-2-2v-9a2 2 0 0 1 2-2zm0 2H10v9h10zm-8.944-7c.683 0 .975.517 1.067.84l.029.132c.04.285-.026 1.002-.76 1.233l-.402.132c-.934.321-2.257.875-3.534 1.743c-1.474 1-2.833 2.383-3.516 4.262a1 1 0 1 1-1.88-.684c.872-2.397 2.578-4.082 4.272-5.232l.332-.22L6.995 5H6a1 1 0 0 1-.117-1.993L6 3z"/></g></svg>
                    </button>

                    <button
                        aria-label="flip the image vertically"
                        id="flip-y"
                        class="transparent_btn"
                    >
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><rect width="24" height="24" fill="none"/><path fill="currentColor" d="M16 5q-.425 0-.712-.288T15 4t.288-.712T16 3t.713.288T17 4t-.288.713T16 5m4 0q-.425 0-.712-.288T19 4t.288-.712T20 3t.713.288T21 4t-.288.713T20 5m0 4q-.425 0-.712-.288T19 8t.288-.712T20 7t.713.288T21 8t-.288.713T20 9m0 4q-.425 0-.712-.288T19 12t.288-.712T20 11t.713.288T21 12t-.288.713T20 13m0 4q-.425 0-.712-.288T19 16t.288-.712T20 15t.713.288T21 16t-.288.713T20 17m-4 4q-.425 0-.712-.288T15 20t.288-.712T16 19t.713.288T17 20t-.288.713T16 21m4 0q-.425 0-.712-.288T19 20t.288-.712T20 19t.713.288T21 20t-.288.713T20 21M5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h3q.425 0 .713.288T9 4t-.288.713T8 5H5v14h3q.425 0 .713.288T9 20t-.288.713T8 21zm6 1V2q0-.425.288-.712T12 1t.713.288T13 2v20q0 .425-.288.713T12 23t-.712-.288T11 22"/></svg>
                    </button>

                    <button
                        aria-label="flip the image horizontally"
                        id="flip-x"
                        class="transparent_btn"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><rect width="24" height="24" fill="none"/><path fill="currentColor" d="M16 5q-.425 0-.712-.288T15 4t.288-.712T16 3t.713.288T17 4t-.288.713T16 5m4 0q-.425 0-.712-.288T19 4t.288-.712T20 3t.713.288T21 4t-.288.713T20 5m0 4q-.425 0-.712-.288T19 8t.288-.712T20 7t.713.288T21 8t-.288.713T20 9m0 4q-.425 0-.712-.288T19 12t.288-.712T20 11t.713.288T21 12t-.288.713T20 13m0 4q-.425 0-.712-.288T19 16t.288-.712T20 15t.713.288T21 16t-.288.713T20 17m-4 4q-.425 0-.712-.288T15 20t.288-.712T16 19t.713.288T17 20t-.288.713T16 21m4 0q-.425 0-.712-.288T19 20t.288-.712T20 19t.713.288T21 20t-.288.713T20 21M5 21q-.825 0-1.412-.587T3 19V5q0-.825.588-1.412T5 3h3q.425 0 .713.288T9 4t-.288.713T8 5H5v14h3q.425 0 .713.288T9 20t-.288.713T8 21zm6 1V2q0-.425.288-.712T12 1t.713.288T13 2v20q0 .425-.288.713T12 23t-.712-.288T11 22"/></svg>
                    </button>
                </div>
                


            </div>
        </div>
        <!-- <div id="output">
            <img src="" alt="" id="output_bg">
        </div> -->
    </div>

    <div id="actions_container">
        <div id="image_controller" class="not_ready">
            <div class="item">
                <p>Scale/Zoom</p>
                <input type="range" name="" id="zoom_slider" min="10" max="200" value="100">
            </div>
            <div class="item">
                <p>Horizontal Offset</p>
                <input type="range" name="" id="x_slider" min="-50" max="50" value="0">
            </div>
            <div class="item">
                <p>Vertical Offset</p>
                <input type="range" name="" id="y_slider" min="-50" max="50" value="0">
            </div>
            
        </div>
        <div id="FABs" class="not_ready">
            <button
                aria-label="Copy result to clipboard"
                id="copy_btn"
                class="fab copy_available"
                onclick="grabscreen()"
                >
                <div id="available" class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><rect width="24" height="24" fill="none"/><g fill="none" fill-rule="evenodd"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M9 2a2 2 0 0 0-2 2v2h2V4h11v11h-2v2h2a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2zM4 7a2 2 0 0 0-2 2v11a2 2 0 0 0 2 2h11a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2zm0 2h11v11H4z"/></g></svg>
                </div>
                <div id="loading" class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><rect width="24" height="24" fill="none"/><path fill="none" stroke="currentColor" stroke-dasharray="16" stroke-dashoffset="16" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3c4.97 0 9 4.03 9 9"><animate fill="freeze" attributeName="stroke-dashoffset" dur="0.2s" values="16;0"/><animateTransform attributeName="transform" dur="1.5s" repeatCount="indefinite" type="rotate" values="0 12 12;360 12 12"/></path></svg>
                </div>
                <div id="copied" class="icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24"><rect width="24" height="24" fill="none"/><g fill="none" fill-rule="evenodd"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M21.546 5.111a1.5 1.5 0 0 1 0 2.121L10.303 18.475a1.6 1.6 0 0 1-2.263 0L2.454 12.89a1.5 1.5 0 1 1 2.121-2.121l4.596 4.596L19.424 5.111a1.5 1.5 0 0 1 2.122 0"/></g></svg>                </div>
            </button>
            
            <button
                aria-label="download the result"
                id="dl"
                class="fab"
                onclick="downloader()"
                >
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 24 24"><rect width="24" height="24" fill="none"/><g fill="none"><path d="M24 0v24H0V0zM12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M5 19a1 1 0 1 0 0 2h14a1 1 0 1 0 0-2zm11.95-7.703a1 1 0 0 0-1.415 0L13 13.833V4a1 1 0 0 0-2 0v9.833l-2.536-2.536a1 1 0 0 0-1.414 1.415l4.243 4.242a1 1 0 0 0 1.414 0l4.243-4.242a1 1 0 0 0 0-1.415"/></g></svg>
            </button>

            <!-- <button
                aria-label="rotate the image"
                id="rotate"
                class="fab"
                >
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><rect width="24" height="24" fill="none"/><g fill="none"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M20 8a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2H10a2 2 0 0 1-2-2v-9a2 2 0 0 1 2-2zm-8.944-5c.683 0 .975.517 1.067.84l.029.132c.04.285-.026 1.002-.76 1.233l-.402.132c-.934.321-2.257.875-3.534 1.743c-1.474 1-2.833 2.383-3.516 4.262a1 1 0 1 1-1.88-.684c.872-2.397 2.578-4.082 4.272-5.232l.332-.22L6.995 5H6a1 1 0 0 1-.117-1.993L6 3z"/></g></svg>            </button> -->
                <a id="download" style="display: none;">
                
            </a>
        </div>
        
    </div>
    
    
</body>







<script>
    //DECLARATIONS
    const 
        zoom_slider = document.getElementById('zoom_slider'),
        x_slider = document.getElementById('x_slider'),
        y_slider = document.getElementById('y_slider'),
        rotate_btn = document.getElementById('rotate'),
        background_image = document.getElementById('background_image'),
        preview_container= document.getElementById('preview_container'),
        output_bg = document.getElementById('output_bg'),
        file = document.getElementById('file'),
        toggle_cropping_tools = document.getElementById('toggle_cropping_tools'),
        cropping_tools = document.getElementById('cropping_tools'),
        flip_x = document.getElementById('flip-x'),
        flip_y = document.getElementById('flip-y')
    ;

    let 
        imagedata,
        xval = 0,
        yval = 0,
        zval = 100,
        rotation = 0,
        xflipped = 0,
        yflipped = 0
    ;

    let 
        mul = "var(--mul)",
        scale_rate = "calc(5 / 1.2)",
        scale_perc = "calc(5 / "+mul+")",
        scale = "calc(calc("+zval/100+" * "+scale_perc+") / "+scale_rate+")",
        bg_style = "scale("+scale+")  translate("+xval+"%, "+yval+"%) rotate("+rotation+"deg) rotateX("+xflipped+"deg) rotateY("+yflipped+"deg)",
        output_style = "scale(calc("+scale+" * "+mul+")) translate("+xval+"%, "+yval+"%) rotate("+rotation+"deg) rotateX("+xflipped+"deg) rotateY("+yflipped+"deg)"
    ;




    //FUNCTIONS
    function refresh_style(){
        scale = "calc(calc("+zval/100+" * "+scale_perc+") / "+scale_rate+")";
        bg_style = "scale("+scale+")  translate("+xval+"%, "+yval+"%) rotate("+rotation+"deg) rotateX("+xflipped+"deg) rotateY("+yflipped+"deg)";
        output_style = "scale(calc("+scale+" * "+mul+")) translate("+xval+"%, "+yval+"%) rotate("+rotation+"deg) rotateX("+xflipped+"deg) rotateY("+yflipped+"deg)";
        background_image.style.transform = bg_style;
        resetCopyBtn();
        // output_bg.style.transform = output_style;
    }

    async function copyImg(src){
        const img = await fetch(src);
        const imgBlob = await img.blob();
        let failed = false;
        try {
           navigator.clipboard.write([
             new ClipboardItem({
                 'image/png': imgBlob, // change image type accordingly
             })
           ]);
            // alert("Image copied to clipboard");
         } catch (error) {
            failed = true;
            // alert("Failed to copy image");
            // console.error(error);
         } finally {
            if (!failed) {
                // alert("Image copied to clipboard");
                document.getElementById('copy_btn').classList.remove('copy_available');
                document.getElementById('copy_btn').classList.add('copy_loading');
                setTimeout(() => {
                    document.getElementById('copy_btn').classList.remove('copy_loading');
                    document.getElementById('copy_btn').classList.add('copy_copied');
                }, 3000);
            } else {
                alert("Failed to copy image");
            }
         }
    }

    function resetCopyBtn(){
        if (document.getElementById('copy_btn').classList.contains('copy_loading')) {
            document.getElementById('copy_btn').classList.remove('copy_loading');
        }
        if (document.getElementById('copy_btn').classList.contains('copy_copied')) {
            document.getElementById('copy_btn').classList.remove('copy_copied');
        }
        if (!(document.getElementById('copy_btn').classList.contains('copy_available'))) {
            document.getElementById('copy_btn').classList.add('copy_available');
        }
    }

    function grabscreen(){ 
        const div_output = document.createElement('div');
        div_output.setAttribute('id', 'output');
        document.getElementById('viewport').appendChild(div_output);

        const div_output_bg = document.createElement('img');
        div_output_bg.setAttribute('id', 'output_bg');
        document.getElementById('output').appendChild(div_output_bg);

        document.getElementById('output_bg').src = imagedata;

        refresh_style();
        document.getElementById('output_bg').style.transform = output_style;


        html2canvas(document.querySelector("#output")).then(canvas => {
        // document.body.appendChild(canvas)
            let image = canvas.toDataURL("image/png");
            copyImg(image);
        });

        document.getElementById('output').remove();
    }

    function downloader(){
        const div_output = document.createElement('div');
        div_output.setAttribute('id', 'output');
        document.getElementById('viewport').appendChild(div_output);

        const div_output_bg = document.createElement('img');
        div_output_bg.setAttribute('id', 'output_bg');
        document.getElementById('output').appendChild(div_output_bg);

        document.getElementById('output_bg').src = imagedata;

        refresh_style();
        document.getElementById('output_bg').style.transform = output_style;

        html2canvas(document.querySelector("#output")).then(canvas => {
            let image = canvas.toDataURL("image/png");
            // copyImg(image);
            document.getElementById('download').download = "background.png";
            document.getElementById('download').href = image;
            document.getElementById('download').click();
        });

        document.getElementById('output').remove();
    }

    const process = (input) => {
        // console.log(input.files[0].type);
        let reader = new FileReader;
        reader.readAsDataURL(input.files[0]);
        reader.onloadend = function () {
            imagedata = reader.result;
            // image.src = imagedata;
            background_image.src = imagedata;
            if (input.files[0].type == "image/png" || input.files[0].type == "image/jpeg" || input.files[0].type == "image/webp") {
                if (document.getElementById('image_controller').classList.contains('not_ready')) {
                    document.getElementById('image_controller').classList.remove('not_ready');
                }
                if (document.getElementById('FABs').classList.contains('not_ready')) {
                    document.getElementById('FABs').classList.remove('not_ready');
                }
                if (document.getElementById('cropping_tools_container').classList.contains('not_ready')) {
                    document.getElementById('cropping_tools_container').classList.remove('not_ready');
                }
            } else {
                if (!(document.getElementById('image_controller').classList.contains('not_ready'))) {
                    document.getElementById('image_controller').classList.add('not_ready');
                }
                if (!(document.getElementById('FABs').classList.contains('not_ready'))) {
                    document.getElementById('FABs').classList.add('not_ready');
                }
                if (!(document.getElementById('cropping_tools_container').classList.contains('not_ready'))) {
                    document.getElementById('cropping_tools_container').classList.add('not_ready');
                    if (!(document.getElementById('cropping_tools').classList.contains('collapsed'))) {
                    document.getElementById('cropping_tools').classList.add('collapsed');
                    
                }
                }
            }

            if (document.getElementById('preview_container').classList.contains('empty')) {
                document.getElementById('preview_container').classList.remove('empty');
            }
            // output_bg.src = imagedata;
            
            // const img = new Image();
            // img.onload = function() {
            //   alert(this.width + 'x' + this.height);
            // }
            // img.src = imagedata;

            zoom_slider.value = 100;
            x_slider.value = 0;
            y_slider.value = 0;
            xval = 0;
            yval = 0;
            zval = 100;
            rotation = 0;
            xflipped = 0;
            yflipped = 0;
            refresh_style();
            resetCopyBtn();
            
        }
    }

    


    //EVENTS
    file.addEventListener('change', ()=>{
        process(file)
    })

    toggle_cropping_tools.addEventListener('click', ()=>{
        cropping_tools.classList.toggle('collapsed');
    })

    flip_x.addEventListener('click', ()=>{
        if(rotation%180 == 0){
            yflipped = yflipped == 0 ? 180 : 0;
        } else {
            xflipped = xflipped == 0 ? 180 : 0;
        }
        // yflipped = yflipped == 0 ? 180 : 0;
        refresh_style();
    })
    flip_y.addEventListener('click', ()=>{
        if(rotation%180 == 0){
            xflipped = xflipped == 0 ? 180 : 0;
        } else {
            yflipped = yflipped == 0 ? 180 : 0;
        }
        // xflipped = xflipped == 0 ? 180 : 0;
        refresh_style();
    })

    refresh_style();
    rotate_btn.addEventListener('click', ()=>{
        rotation += 90;
        refresh_style();
    })
    zoom_slider.oninput = function() {
        zval = this.value
        refresh_style();
    }

    x_slider.oninput = function() {
        xval = this.value
        refresh_style();
    }

    y_slider.oninput = function() {
        yval = this.value
        refresh_style();
    }

    
</script>
</html>