<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css"><link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

</head>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.js" integrity="sha512-sn/GHTj+FCxK5wam7k9w4gPPm6zss4Zwl/X9wgrvGMFbnedR8lTUSLdsolDRBRzsX6N+YgG6OWyvn9qaFVXH9w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<body>
    <div id="viewport">
        <div id="preview_container">
            <img src="" alt="" id="background_image">
        </div>
        <div id="frame">
            <input type="file" name="" id="file">
        </div>
        <div id="output">
            <img src="" alt="" id="output_bg">
        </div>
    </div>

    <div id="actions_container">
        <div id="image_controller">
            <div class="item">
                <p>Scale/Zoom</p>
                <input type="range" name="" id="zoom_slider" min="10" max="200" value="100">
            </div>
            <div class="item">
                <p>Horizontal Offset</p>
                <input type="range" name="" id="x_slider" min="-50" max="50" value="0">
            </div>
            <div class="item">
                <p>Vertical Offset</p>
                <input type="range" name="" id="y_slider" min="-50" max="50" value="0">
            </div>
            
        </div>
        <div class="group">
            <button onclick="grabscreen()">
                Copy Background
            </button>
            <button id="dl" onclick="downloader()">
                <svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 24 24"><rect width="24" height="24" fill="none"/><g fill="none"><path d="M24 0v24H0V0zM12.594 23.258l-.012.002l-.071.035l-.02.004l-.014-.004l-.071-.036q-.016-.004-.024.006l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.016-.018m.264-.113l-.014.002l-.184.093l-.01.01l-.003.011l.018.43l.005.012l.008.008l.201.092q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.003-.011l.018-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M5 18.5a1.5 1.5 0 0 0 0 3h14a1.5 1.5 0 0 0 0-3zm12.303-7.556a1.5 1.5 0 0 0-2.121 0L13.5 12.625V4a1.5 1.5 0 0 0-3 0v8.626l-1.682-1.682a1.5 1.5 0 1 0-2.122 2.121l4.243 4.243a1.5 1.5 0 0 0 2.121 0l4.243-4.243a1.5 1.5 0 0 0 0-2.121"/></g></svg>
            </button>
            <a id="download" style="display: none;">
                
            </a>
        </div>
        
    </div>
    
    
</body>







<script>
    const zoom_slider = document.getElementById('zoom_slider');
    const x_slider = document.getElementById('x_slider');
    const y_slider = document.getElementById('y_slider');
    const background_image = document.getElementById('background_image');
    const preview_container= document.getElementById('preview_container');
    const output_bg = document.getElementById('output_bg');
    const file = document.getElementById('file');
    let xval = 0;
    let yval = 0;
    let zval = 100;
    // const image = document.getElementById('image');
    async function copyImg(src){
        const img = await fetch(src);
        const imgBlob = await img.blob();
        try {
           navigator.clipboard.write([
             new ClipboardItem({
                 'image/png': imgBlob, // change image type accordingly
             })
           ]);
         } catch (error) {
             console.error(error);
         }
    }
    function grabscreen(){
        
        html2canvas(document.querySelector("#output")).then(canvas => {
        // document.body.appendChild(canvas)
        let image = canvas.toDataURL("image/png");
        copyImg(image);
        
    });
    }
    function downloader(){
        
        html2canvas(document.querySelector("#output")).then(canvas => {
        // document.body.appendChild(canvas)
        let image = canvas.toDataURL("image/png");
        copyImg(image);
        document.getElementById('download').download = "background.png";
        document.getElementById('download').href = image;
        document.getElementById('download').click();
        
    });
    }

    file.addEventListener('change', ()=>{process(file)})
    const file_click = () => {
        file.click();
    }
    const process = (input) => {
        // console.log(input.files);
        let reader = new FileReader;
        reader.readAsDataURL(input.files[0]);
        reader.onloadend = function () {
            let imagedata = reader.result;
            // image.src = imagedata;
            background_image.src = imagedata;
            output_bg.src = imagedata;
            
            // const img = new Image();
            // img.onload = function() {
            //   alert(this.width + 'x' + this.height);
            // }
            // img.src = imagedata;

            zoom_slider.value = 100;
            x_slider.value = 0;
            y_slider.value = 0;
            xval = 0;
            yval = 0;
            zval = 100;
            // background_image.style.transform = "scale("+zval/100+") translate("+xval+"%, "+yval+"%)";
            background_image.style.transform = "scale(calc(calc("+zval/100+" * calc(5 / var(--mul))) / 2.5))  translate("+xval+"%, "+yval+"%)";
            output_bg.style.transform = "scale(calc(calc(calc("+zval/100+" * calc(5 / var(--mul))) / 2.5) * var(--mul))) translate("+xval+"%, "+yval+"%)";
            // document.getElementById('background_image').style.backgroundImage="url("+imagedata+")";
            // console.log(imagedata)
        }
    }

    
    background_image.style.transform = "scale(calc(calc("+zval/100+" * calc(5 / var(--mul))) / 2.5))  translate("+xval+"%, "+yval+"%)";
    output_bg.style.transform = "scale(calc(calc(calc("+zval/100+" * calc(5 / var(--mul))) / 2.5) * var(--mul))) translate("+xval+"%, "+yval+"%)";

    zoom_slider.oninput = function() {
        // console.log(this.value);
        zval = this.value
        // background_image.style.backgroundSize= this.value +"%";
        // background_image.style.height = this.value + "%";
        // background_image.style.width = this.value + "%";
        background_image.style.transform = "scale(calc(calc("+zval/100+" * calc(5 / var(--mul))) / 2.5))  translate("+xval+"%, "+yval+"%)";
        output_bg.style.transform = "scale(calc(calc(calc("+zval/100+" * calc(5 / var(--mul))) / 2.5) * var(--mul))) translate("+xval+"%, "+yval+"%)";
    }
    x_slider.oninput = function() {
        // console.log(this.value);
        xval = this.value
        background_image.style.transform = "scale(calc(calc("+zval/100+" * calc(5 / var(--mul))) / 2.5))  translate("+xval+"%, "+yval+"%)";
        output_bg.style.transform = "scale(calc(calc(calc("+zval/100+" * calc(5 / var(--mul))) / 2.5) * var(--mul))) translate("+xval+"%, "+yval+"%)";
        // background_image.style.marginLeft = this.value + "%";
    }
    y_slider.oninput = function() {
        // console.log(this.value);
        yval = this.value
        background_image.style.transform = "scale(calc(calc("+zval/100+" * calc(5 / var(--mul))) / 2.5))  translate("+xval+"%, "+yval+"%)";
        output_bg.style.transform = "scale(calc(calc(calc("+zval/100+" * calc(5 / var(--mul))) / 2.5) * var(--mul))) translate("+xval+"%, "+yval+"%)";
        // background_image.style.marginTop = this.value + "%";
    }
    // preview_container.style.backgroundColor = "var(--c1)";

    
</script>
</html>