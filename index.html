<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css"><link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

</head>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.js" integrity="sha512-sn/GHTj+FCxK5wam7k9w4gPPm6zss4Zwl/X9wgrvGMFbnedR8lTUSLdsolDRBRzsX6N+YgG6OWyvn9qaFVXH9w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<body>
    <div id="viewport">
        <div id="preview_container">
            <img src="" alt="" id="background_image">
        </div>
        <div id="frame">
            <input type="file" name="" id="file">
        </div>
        <div id="output">
            <img src="" alt="" id="output_bg">
        </div>
    </div>

    <div id="actions_container">
        <div id="image_controller">
            <div class="item">
                <p>Scale/Zoom</p>
                <input type="range" name="" id="zoom_slider" min="10" max="200" value="100">
            </div>
            <div class="item">
                <p>Horizontal Offset</p>
                <input type="range" name="" id="x_slider" min="-50" max="50" value="0">
            </div>
            <div class="item">
                <p>Vertical Offset</p>
                <input type="range" name="" id="y_slider" min="-50" max="50" value="0">
            </div>
            
        </div>
        
        <button onclick="grabscreen()">
            Copy Background
        </button>
    </div>
    
    
</body>







<script>
    const zoom_slider = document.getElementById('zoom_slider');
    const x_slider = document.getElementById('x_slider');
    const y_slider = document.getElementById('y_slider');
    const background_image = document.getElementById('background_image');
    const preview_container= document.getElementById('preview_container');
    const output_bg = document.getElementById('output_bg');
    const file = document.getElementById('file');
    let xval = 0;
    let yval = 0;
    let zval = 100;
    // const image = document.getElementById('image');
    async function copyImg(src){
        const img = await fetch(src);
        const imgBlob = await img.blob();
        try {
           navigator.clipboard.write([
             new ClipboardItem({
                 'image/png': imgBlob, // change image type accordingly
             })
           ]);
         } catch (error) {
             console.error(error);
         }
    }
    function grabscreen(){
        
        html2canvas(document.querySelector("#output")).then(canvas => {
        // document.body.appendChild(canvas)
        let image = canvas.toDataURL("image/png");
        copyImg(image);
        
    });
    }

    file.addEventListener('change', ()=>{process(file)})
    const file_click = () => {
        file.click();
    }
    const process = (input) => {
        // console.log(input.files);
        let reader = new FileReader;
        reader.readAsDataURL(input.files[0]);
        reader.onloadend = function () {
            let imagedata = reader.result;
            // image.src = imagedata;
            background_image.src = imagedata;
            output_bg.src = imagedata;
            
            // const img = new Image();
            // img.onload = function() {
            //   alert(this.width + 'x' + this.height);
            // }
            // img.src = imagedata;

            zoom_slider.value = 100;
            x_slider.value = 0;
            y_slider.value = 0;
            xval = 0;
            yval = 0;
            zval = 100;
            // background_image.style.transform = "scale("+zval/100+") translate("+xval+"%, "+yval+"%)";
            background_image.style.transform = "scale(calc(calc("+zval/100+" * calc(5 / var(--mul))) / 2.5))  translate("+xval+"%, "+yval+"%)";
            output_bg.style.transform = "scale(calc(calc(calc("+zval/100+" * calc(5 / var(--mul))) / 2.5) * var(--mul))) translate("+xval+"%, "+yval+"%)";
            // document.getElementById('background_image').style.backgroundImage="url("+imagedata+")";
            // console.log(imagedata)
        }
    }

    
    background_image.style.transform = "scale(calc(calc("+zval/100+" * calc(5 / var(--mul))) / 2.5))  translate("+xval+"%, "+yval+"%)";
    output_bg.style.transform = "scale(calc(calc(calc("+zval/100+" * calc(5 / var(--mul))) / 2.5) * var(--mul))) translate("+xval+"%, "+yval+"%)";

    zoom_slider.oninput = function() {
        // console.log(this.value);
        zval = this.value
        // background_image.style.backgroundSize= this.value +"%";
        // background_image.style.height = this.value + "%";
        // background_image.style.width = this.value + "%";
        background_image.style.transform = "scale(calc(calc("+zval/100+" * calc(5 / var(--mul))) / 2.5))  translate("+xval+"%, "+yval+"%)";
        output_bg.style.transform = "scale(calc(calc(calc("+zval/100+" * calc(5 / var(--mul))) / 2.5) * var(--mul))) translate("+xval+"%, "+yval+"%)";
    }
    x_slider.oninput = function() {
        // console.log(this.value);
        xval = this.value
        background_image.style.transform = "scale(calc(calc("+zval/100+" * calc(5 / var(--mul))) / 2.5))  translate("+xval+"%, "+yval+"%)";
        output_bg.style.transform = "scale(calc(calc(calc("+zval/100+" * calc(5 / var(--mul))) / 2.5) * var(--mul))) translate("+xval+"%, "+yval+"%)";
        // background_image.style.marginLeft = this.value + "%";
    }
    y_slider.oninput = function() {
        // console.log(this.value);
        yval = this.value
        background_image.style.transform = "scale(calc(calc("+zval/100+" * calc(5 / var(--mul))) / 2.5))  translate("+xval+"%, "+yval+"%)";
        output_bg.style.transform = "scale(calc(calc(calc("+zval/100+" * calc(5 / var(--mul))) / 2.5) * var(--mul))) translate("+xval+"%, "+yval+"%)";
        // background_image.style.marginTop = this.value + "%";
    }
    // preview_container.style.backgroundColor = "var(--c1)";

    
</script>
</html>